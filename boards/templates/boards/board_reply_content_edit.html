{% extends "base_boards.html" %}

{% block content %}
{% load staticfiles%}
{% load widget_tweaks %}

<div class="container">
    <div class="me_title2">
        <a href="{%url 'boards:index'%}">
        <span class="glyphicon glyphicon glyphicon-bullhorn" aria-hidden="true"></span>
        공유게시판</a> >
        <a href="{%url 'boards:board_topic' pk=board.pk%}">{{board.name}}</a> >
        <a href="{% url 'boards:board_content' pk=topic.board.id topic_pk=topic.id  %}">{{topic.title|truncatechars:20}}</a>
    </div>
    <div class="panel panel-success">
        <div class="panel-heading">
            <div class="row">
                <div class="container">
                    {{topic}}
                </div>
                <div class="container">
                    <span class="glyphicon glyphicon-eye-open" aria-hidden="true"> {{topic.views}}</span>
                </div>
            </div>
        </div>
        <div class="panel-body">
            <div class="col-md-2 col-xs-12">
                <div class="row">
                    <div class="col-md-12 col-xs-4" align="center">
                        <img class="img-rounded" src="{{topic.user.userprofile.thumbnail.url}}"
                             style="object-fit:cover;width:100%;">
                    </div>
                    <div class="col-md-12 col-xs-8" align="center">
                        <div class="col-md-12  col-xs-12 text-center">
                            <strong>
                                {{topic.user}}
                            </strong>
                        </div>
                        <div class="col-md-12  col-xs-12 text-center">
                            {% if topic.updated_at is None %}
                            <span class="glyphicon glyphicon-time" aria-hidden="true"> <small>{{topic.created_at}} (등록)</small></span>
                            {% else %}
                            <span class="glyphicon glyphicon-time" aria-hidden="true"> <small>{{topic.updated_at}} (수정)</small></span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-10 col-xs-12">
                <div class="row">
                    <p>{{topic.message|safe}}</p>
                </div>
            </div>
        </div>

        <div class="panel-footer">
            <div class="row">
                {% if request.user == topic.user%}
                <div class="col-md-offset-6 col-md-2 col-md-2 col-xs-4">
                    <a href="{% url 'boards:remove_content' pk=topic.board.id topic_pk=topic.id %}"
                       class="btn btn-success btn-block">삭제</a>
                </div>
                <div class="col-md-2 col-xs-4">
                    <a href="{% url 'boards:edit_content' pk=topic.board.id topic_pk=topic.id %}"
                       class="btn btn-success btn-block">수 정</a>
                </div>
                <div class="col-md-2 col-xs-4">
                    <a href="{% url 'boards:add_reply' pk=topic.board.id topic_pk=topic.id %}#{{topic.post.count|default:0}}"
                       class="btn btn-success btn-block">댓 글</a>
                </div>
                {% else %}
                <div class="col-md-offset-10 col-md-2 col-xs-12">
                    <a href="{% url 'boards:add_reply' pk=topic.board.id topic_pk=topic.id %}#{{topic.post.count|default:0}}"
                       class="btn btn-success btn-block">댓 글</a>
                </div>
                {% endif%}
            </div>
        </div>

    </div>
    {% if topic.post.count > 1%}
    <h3>댓글</h3>
    {%endif%}
    {% if topic.post.count > 1%}
    {%for post in post_list%}
    {% if post.pk == post_pk %}
    <div class="panel panel-success">
        <div class="panel-body" id="{{post.order}}">
            <form method="post" novalidate>
                {% csrf_token %}
                {{ form.media }}
                {{ form.as_p }}
                <div class="row">
                    <div class="col-md-offset-10 col-md-2">
                        <button type="submit" class="btn btn-success btn-block">수정하기</button>
                    </div>
                </div>
            </form>
            <br>
        </div>
    </div>
    {% else%}
    <div class="panel panel-success">
        <div class="panel-body" id="{{post.order}}">
            <div class="col-md-2 col-xs-12">
                <div class="row">
                    <div class="col-md-12 col-xs-4">
                        <img class="img-rounded" src="{{post.user.userprofile.thumbnail.url}}"
                             style="object-fit:cover;width:100%;">
                    </div>
                    <div class="row col-md-12  col-xs-8">
                        <div class="col-md-12 col-xs-12 text-center">
                            <strong>
                                {{post.user}}
                            </strong>
                        </div>
                        <div class="col-md-12  col-xs-12 text-center">
                            {% if post.updated_at is None %}
                            <span class="glyphicon glyphicon-time" aria-hidden="true"> <small>{{post.created_at}} (등록)</small></span>
                            {% else %}
                            <span class="glyphicon glyphicon-time" aria-hidden="true"> <small>{{post.updated_at}} (수정)</small></span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-10 col-xs-12">
                <!--{{post.order}}-->
                <div class="row">
                    <p>{{post.message|safe}}</p>
                </div>
            </div>
        </div>
        <div class="panel-footer">
            <div class="row">
                <div class="me_title2_nopadding col-md-2 col-xs-3">
                    #{{post.pk}}
                </div>
                {% if request.user == post.user%}
                <div class="col-md-offset-4 col-md-2 col-md-2 col-xs-3">
                    <a href="{% url 'boards:remove_reply' pk=topic.board.id topic_pk=topic.id post_pk=post.id %}"
                       class="btn btn-success btn-block">삭 제</a>
                </div>
                <div class="col-md-2 col-xs-3">
                    <a href="{% url 'boards:edit_reply' pk=topic.board.id topic_pk=topic.id post_pk=post.id %}#{{post.order}}"
                       class="btn btn-success btn-block">수 정</a>
                </div>
                <div class="col-md-2 col-xs-3">
                    <a href="{% url 'boards:reply_to_reply' pk=topic.board.id topic_pk=topic.id post_pk=post.id %}#{{post.order}}"
                       class="btn btn-success btn-block">댓 글</a>
                </div>
                {% else%}
                <div class="col-md-offset-8 col-md-2 col-xs-9">
                    <a href="{% url 'boards:reply_to_reply' pk=topic.board.id topic_pk=topic.id post_pk=post.id %}#{{post.order}}"
                       class="btn btn-success btn-block">댓 글</a>
                </div>
                {% endif%}
            </div>
        </div>
    </div>
    {% endif %}
    {% endfor %}
    {% endif %}

    {% if post_list.has_other_pages %}
    <div class="container" align="center">
        <nav aria-label="Post pagination" class="mb-4">
            <ul class="pagination pagination-sm">
                {% if post_list.number > 1 %}
                <li class="page-item">
                    <a class="page-link" href="?page=1"> << </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link"> << </span>
                </li>
                {% endif %}

                {% if post_list.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ post_list.previous_page_number }}"> < </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link"> < </span>
                </li>
                {% endif %}

                {% for page_num in post_list.paginator.page_range %}
                {% if post_list.number == page_num %}
                <li class="page-item active">
            <span class="page-link">
              {{ page_num }}
              <span class="sr-only">(current)</span>
            </span>
                </li>
                {% elif page_num > post_list.number|add:'-3' and page_num < post_list.number|add:'3' %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ page_num }}">{{ page_num }}</a>
                </li>
                {% endif %}
                {% endfor %}

                {% if post_list.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ post_list.next_page_number }}"> > </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link"> > </span>
                </li>
                {% endif %}

                {% if post_list.number != post_list.paginator.num_pages %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ post_list.paginator.num_pages }}"> >> </a>
                </li>
                {% else %}
                <li class="page-item disabled">
                    <span class="page-link"> >> </span>
                </li>
                {% endif %}
            </ul>
        </nav>
    </div>

    {% endif %}

</div>

{% endblock content %}